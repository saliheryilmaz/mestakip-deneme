<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bildirim Butonu Test</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1>Bildirim Butonu Test</h1>
        <p>Aşağıdaki bildirim butonuna tıklayın ve dropdown açılmalı:</p>
        
        <!-- Notifications -->
        <div class="dropdown">
            <button class="btn btn-outline-secondary position-relative" type="button"
                data-bs-toggle="dropdown" 
                data-bs-auto-close="outside"
                aria-expanded="false" 
                id="notificationButton">
                <i class="bi bi-bell"></i>
                <span
                    class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger"
                    id="notificationBadge">
                    7
                </span>
            </button>
            <ul class="dropdown-menu dropdown-menu-end" id="notificationDropdownMenu"
                aria-labelledby="notificationButton"
                style="width: 350px; max-height: 400px; overflow-y: auto;">
                <li class="dropdown-header d-flex justify-content-between align-items-center">
                    <span>Bildirimler</span>
                    <button class="btn btn-sm btn-link text-primary p-0" id="markAllReadBtn"
                        style="font-size: 0.75rem;" type="button">
                        Tümünü Okundu İşaretle
                    </button>
                </li>
                <li>
                    <hr class="dropdown-divider">
                </li>
                <li>
                    <a class="dropdown-item" href="#">
                        <div class="d-flex">
                            <div class="me-3">
                                <i class="bi bi-bell-fill text-primary"></i>
                            </div>
                            <div>
                                <div class="fw-bold">Test Bildirimi 1</div>
                                <div class="text-muted small">Bu bir test bildirimidir</div>
                                <div class="text-muted small">5 dakika önce</div>
                            </div>
                        </div>
                    </a>
                </li>
                <li>
                    <hr class="dropdown-divider">
                </li>
                <li>
                    <a class="dropdown-item" href="#">
                        <div class="d-flex">
                            <div class="me-3">
                                <i class="bi bi-calendar-event text-success"></i>
                            </div>
                            <div>
                                <div class="fw-bold">Test Bildirimi 2</div>
                                <div class="text-muted small">Takvim etkinliği hatırlatıcısı</div>
                                <div class="text-muted small">15 dakika önce</div>
                            </div>
                        </div>
                    </a>
                </li>
            </ul>
        </div>
        
        <div class="mt-4">
            <h3>Konsol Logları:</h3>
            <div id="console" class="border p-3 bg-light" style="height: 300px; overflow-y: auto; font-family: monospace;">
            </div>
        </div>
    </div>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Console log'ları sayfada göster
        const consoleDiv = document.getElementById('console');
        const originalLog = console.log;
        const originalError = console.error;
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            const message = args.join(' ');
            consoleDiv.innerHTML += `<div class="text-success">[LOG] ${message}</div>`;
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            const message = args.join(' ');
            consoleDiv.innerHTML += `<div class="text-danger">[ERROR] ${message}</div>`;
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        };
        
        // Test kodu
        document.addEventListener('DOMContentLoaded', function() {
            console.log('=== Sayfa Yüklendi ===');
            
            // Bootstrap kontrolü
            if (typeof bootstrap === 'undefined') {
                console.error('Bootstrap yüklenmedi!');
                return;
            }
            console.log('Bootstrap yüklendi, versiyon: ' + bootstrap.Dropdown.VERSION);
            
            // Bildirim butonu
            const notificationButton = document.getElementById('notificationButton');
            const notificationDropdown = document.getElementById('notificationDropdownMenu');
            
            if (notificationButton && notificationDropdown) {
                console.log('Bildirim butonu ve dropdown bulundu');
                
                try {
                    // Dropdown instance oluştur
                    let dropdownInstance = bootstrap.Dropdown.getInstance(notificationButton);
                    
                    if (!dropdownInstance) {
                        dropdownInstance = new bootstrap.Dropdown(notificationButton, {
                            autoClose: 'outside',
                            boundary: 'viewport'
                        });
                        console.log('Dropdown instance oluşturuldu');
                    }
                    
                    // Event listener'lar
                    notificationButton.addEventListener('click', function(e) {
                        console.log('Butona tıklandı');
                        console.log('aria-expanded: ' + notificationButton.getAttribute('aria-expanded'));
                    });
                    
                    notificationButton.addEventListener('shown.bs.dropdown', function() {
                        console.log('Dropdown açıldı!');
                    });
                    
                    notificationButton.addEventListener('hidden.bs.dropdown', function() {
                        console.log('Dropdown kapandı');
                    });
                    
                    // Mark all read butonu
                    const markAllReadBtn = document.getElementById('markAllReadBtn');
                    if (markAllReadBtn) {
                        markAllReadBtn.addEventListener('click', function(e) {
                            e.preventDefault();
                            e.stopPropagation();
                            console.log('Tümünü okundu işaretle butonuna tıklandı');
                        });
                    }
                    
                } catch (error) {
                    console.error('Hata: ' + error.message);
                }
            } else {
                console.error('Bildirim butonu veya dropdown bulunamadı!');
            }
            
            console.log('=== Hazır ===');
        });
    </script>
</body>
</html>
