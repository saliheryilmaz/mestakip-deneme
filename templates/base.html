<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
<head>
    <!-- Meta Tags -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Modern Bootstrap 5 Admin Template - Clean, responsive dashboard">
    <meta name="keywords" content="bootstrap, admin, dashboard, template, modern, responsive">
    <meta name="author" content="Bootstrap Admin Template">
    <meta name="csrf-token" content="{{ csrf_token }}">
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="Mestakip">
    <meta property="og:description" content="Clean and modern admin dashboard template built with Bootstrap 5">
    <meta property="og:type" content="website">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="{% load static %}{% static 'icons/favicon.svg' %}">
    <link rel="icon" type="image/png" href="{% load static %}{% static 'icons/favicon.png' %}">
    
    <!-- Preconnect to external domains -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Title -->
    <title>{% block title %}Dashboard - Mestakip{% endblock %}</title>
    
    <!-- Theme Color -->
    <meta name="theme-color" content="#6366f1">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="{% load static %}{% static 'manifest.json' %}">
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.css" rel="stylesheet">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{% load static %}{% static 'main-DLfE7m78.css' %}">
    
    {% block extra_css %}{% endblock %}
    
    <!-- Sidebar Toggle Styles -->
    <style>
    .admin-wrapper {
        transition: all 0.3s ease;
    }
    
    .admin-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        height: 100vh;
        background: #1f2937;
        z-index: 1000;
        overflow-y: auto;
        width: 250px;
        transition: width 0.3s ease;
    }
    
    .admin-sidebar .nav-link span {
        transition: opacity 0.3s ease;
    }
    
    .admin-sidebar .nav-link .badge {
        transition: opacity 0.3s ease;
    }
    
    .admin-sidebar .nav-link .ms-auto {
        transition: opacity 0.3s ease;
    }
    
    .admin-sidebar .text-muted {
        transition: opacity 0.3s ease;
    }
    
    .admin-main {
        margin-left: 250px;
        min-height: 100vh;
        background: #f8fafc;
        transition: margin-left 0.3s ease;
    }
    
    .admin-wrapper.sidebar-collapsed .admin-sidebar {
        width: 60px;
        overflow: hidden;
    }
    
    .admin-wrapper.sidebar-collapsed .admin-main {
        margin-left: 60px;
    }
    
    .admin-wrapper.sidebar-collapsed .admin-sidebar .nav-link span {
        opacity: 0;
        visibility: hidden;
    }
    
    .admin-wrapper.sidebar-collapsed .admin-sidebar .nav-link .badge {
        opacity: 0;
        visibility: hidden;
    }
    
    .admin-wrapper.sidebar-collapsed .admin-sidebar .nav-link .ms-auto {
        opacity: 0;
        visibility: hidden;
    }
    
    .admin-wrapper.sidebar-collapsed .admin-sidebar .text-muted {
        opacity: 0;
        visibility: hidden;
    }
    
    .admin-wrapper.sidebar-collapsed .admin-sidebar .nav-link {
        justify-content: center;
        padding: 0.75rem 0.5rem;
    }
    
    .admin-wrapper.sidebar-collapsed .admin-sidebar .nav-link i {
        margin-right: 0;
    }
    
    .admin-wrapper.sidebar-collapsed .admin-sidebar .navbar-brand {
        justify-content: center;
        padding: 1rem 0.5rem;
    }
    
    .admin-wrapper.sidebar-collapsed .admin-sidebar .navbar-brand h1 {
        display: none;
    }
    
    .admin-wrapper.sidebar-collapsed .admin-sidebar .navbar-brand img {
        margin-right: 0;
    }
    
    .admin-wrapper.sidebar-collapsed .admin-sidebar .sidebar-header {
        justify-content: center;
        padding: 1rem 0.5rem;
    }
    
    .admin-wrapper.sidebar-collapsed .sidebar-toggle-btn {
        display: none !important;
    }
    
    .admin-sidebar .sidebar-header .sidebar-toggle-btn,
    .sidebar-toggle-btn {
        display: flex !important;
        background: #6366f1 !important;
        border: 2px solid #4f46e5 !important;
        color: white !important;
        padding: 0.75rem !important;
        border-radius: 8px !important;
        transition: all 0.3s ease !important;
        min-width: 50px !important;
        height: 50px !important;
        align-items: center !important;
        justify-content: center !important;
        box-shadow: 0 4px 8px rgba(0,0,0,0.2) !important;
        cursor: pointer !important;
        font-size: 1rem !important;
        position: relative !important;
        z-index: 1000 !important;
        margin: 0 !important;
        font-family: inherit !important;
        line-height: 1.5 !important;
        text-align: center !important;
        text-decoration: none !important;
        vertical-align: middle !important;
        user-select: none !important;
    }
    
    .admin-sidebar .sidebar-header .sidebar-toggle-btn:hover,
    .sidebar-toggle-btn:hover {
        background: #4f46e5 !important;
        border-color: #3730a3 !important;
        color: white !important;
        transform: scale(1.05) !important;
        box-shadow: 0 6px 12px rgba(0,0,0,0.3) !important;
    }
    
    .admin-sidebar .sidebar-header .sidebar-toggle-btn i,
    .sidebar-toggle-btn i {
        font-size: 1.2rem !important;
        font-weight: bold !important;
        color: white !important;
    }
    
    @media (max-width: 768px) {
        .admin-sidebar {
            transform: translateX(-100%);
        }
        
        .admin-main {
            margin-left: 0;
        }
        
        .admin-wrapper.sidebar-collapsed .admin-sidebar {
            transform: translateX(-100%);
        }
    }
    </style>
</head>

<body data-page="{% block page_name %}dashboard{% endblock %}" class="admin-layout">
    <!-- Loading Screen -->
    <div id="loading-screen" class="loading-screen">
        <div class="loading-spinner">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
        </div>
    </div>

    <!-- Main Wrapper -->
    <div class="admin-wrapper" id="admin-wrapper">
        
        <!-- Header -->
        <header class="admin-header">
            <nav class="navbar navbar-expand-lg navbar-light bg-white border-bottom">
                <div class="container-fluid">
                    <!-- Logo/Brand - Now first on the left -->
                    <a class="navbar-brand d-flex align-items-center" href="{% url 'dashboard:index' %}">
                        <img src="{% load static %}{% static 'images/logo.svg' %}" alt="Logo" height="32" class="d-inline-block align-text-top me-2">
                        <h1 class="h4 mb-0 fw-bold text-primary">MesTakip</h1>
                    </a>

                    <!-- Search Bar -->
                    <div class="search-container flex-grow-1 mx-4">
                        <div class="position-relative">
                            <input type="search" 
                                   class="form-control" 
                                   placeholder="Search... (Ctrl+K)"
                                   data-search-input
                                   aria-label="Search">
                            <i class="bi bi-search position-absolute top-50 end-0 translate-middle-y me-3"></i>
                        </div>
                    </div>

                    <!-- Right Side Icons -->
                    <div class="navbar-nav flex-row">
                        <!-- Theme Toggle -->
                        <button class="btn btn-outline-secondary me-2" 
                                type="button" 
                                data-theme-toggle
                                data-bs-toggle="tooltip"
                                data-bs-placement="bottom"
                                title="Toggle theme">
                            <i class="bi bi-sun-fill"></i>
                        </button>

                        <!-- Fullscreen Toggle -->
                        <button class="btn btn-outline-secondary me-2" 
                                type="button" 
                                data-fullscreen-toggle
                                data-bs-toggle="tooltip"
                                data-bs-placement="bottom"
                                title="Toggle fullscreen">
                            <i class="bi bi-arrows-fullscreen icon-hover"></i>
                        </button>

                        <!-- Notifications -->
                        <div class="dropdown me-2">
                            <button class="btn btn-outline-secondary position-relative" 
                                    type="button" 
                                    data-bs-toggle="dropdown" 
                                    aria-expanded="false">
                                <i class="bi bi-bell"></i>
                                <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                                    3
                                </span>
                            </button>
                            <ul class="dropdown-menu dropdown-menu-end">
                                <li><h6 class="dropdown-header">Notifications</h6></li>
                                <li><a class="dropdown-item" href="#">New user registered</a></li>
                                <li><a class="dropdown-item" href="#">Server status update</a></li>
                                <li><a class="dropdown-item" href="#">New message received</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item text-center" href="#">View all notifications</a></li>
                            </ul>
                        </div>

                        <!-- User Menu -->
                        {% if user.is_authenticated %}
                        <div class="dropdown">
                            <button class="btn btn-outline-secondary d-flex align-items-center" 
                                    type="button" 
                                    data-bs-toggle="dropdown" 
                                    aria-expanded="false">
                                <img src="{% load static %}{% static 'images/avatar-placeholder.svg' %}" 
                                     alt="User Avatar" 
                                     width="24" 
                                     height="24" 
                                     class="rounded-circle me-2">
                                <span class="d-none d-md-inline">
                                    {% if user.first_name and user.last_name %}
                                        {{ user.first_name }} {{ user.last_name }}
                                    {% elif user.first_name %}
                                        {{ user.first_name }}
                                    {% else %}
                                        {{ user.username }}
                                    {% endif %}
                                </span>
                                <i class="bi bi-chevron-down ms-1"></i>
                            </button>
                            <ul class="dropdown-menu dropdown-menu-end">
                                <li><h6 class="dropdown-header">
                                    {% if user.first_name and user.last_name %}
                                        {{ user.first_name }} {{ user.last_name }}
                                    {% elif user.first_name %}
                                        {{ user.first_name }}
                                    {% else %}
                                        {{ user.username }}
                                    {% endif %}
                                    <br><small class="text-muted">
                                        {% if user.userprofile.role == 'admin' %}
                                            <span class="badge bg-danger">Admin</span>
                                        {% else %}
                                            <span class="badge bg-info">Yönetici</span>
                                        {% endif %}
                                    </small>
                                </h6></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="#"><i class="bi bi-person me-2"></i>Profil</a></li>
                                <li><a class="dropdown-item" href="#"><i class="bi bi-gear me-2"></i>Ayarlar</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="{% url 'dashboard:logout' %}"><i class="bi bi-box-arrow-right me-2"></i>Çıkış Yap</a></li>
                            </ul>
                        </div>
                        {% else %}
                        <div class="d-flex gap-2">
                            <a href="{% url 'dashboard:login' %}" class="btn btn-primary">
                                <i class="bi bi-box-arrow-in-right me-1"></i>
                                Giriş Yap
                            </a>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </nav>
        </header>

        <!-- Sidebar -->
        <aside class="admin-sidebar" id="admin-sidebar">
            <div class="sidebar-content">
                <!-- Sidebar Header -->
                <div class="sidebar-header d-flex align-items-center justify-content-between p-3">
                    <a class="navbar-brand d-flex align-items-center" href="{% url 'dashboard:index' %}">
                        <img src="{% load static %}{% static 'images/logo.svg' %}" alt="Logo" height="32" class="d-inline-block align-text-top me-2">
                        <h1 class="h4 mb-0 fw-bold text-white">MesTakip</h1>
                    </a>
                    <button class="sidebar-toggle-btn" 
                            type="button" 
                            data-sidebar-toggle
                            aria-label="Toggle sidebar"
                            title="Toggle Sidebar">
                        <i class="bi bi-list"></i>
                    </button>
                </div>
                
                <nav class="sidebar-nav">
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link {% if request.resolver_match.url_name == 'index' %}active{% endif %}" href="{% url 'dashboard:index' %}">
                                <i class="bi bi-speedometer2"></i>
                                <span>Dashboard</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'dashboard:analytics' %}">
                                <i class="bi bi-graph-up"></i>
                                <span>Analytics</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'dashboard:users' %}">
                                <i class="bi bi-people"></i>
                                <span>Kullanıcılar</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'dashboard:products' %}">
                                <i class="bi bi-box"></i>
                                <span>Products</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'dashboard:orders' %}">
                                <i class="bi bi-bag-check"></i>
                                <span>Sipariş Envanteri Dashboard</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'dashboard:forms' %}">
                                <i class="bi bi-ui-checks"></i>
                                <span>Kontrol Edilen Siparişler</span>
                                <span class="badge bg-success rounded-pill ms-auto">New</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'dashboard:elements' %}">
                                <i class="bi bi-box-seam"></i>
                                <span>Sipariş Envanteri</span>
                                <span class="badge bg-success rounded-pill ms-auto">5</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'dashboard:reports' %}">
                                <i class="bi bi-file-earmark-text"></i>
                                <span>İptal Edilen Siparişler Raporu</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'dashboard:messages' %}">
                                <i class="bi bi-chat-dots"></i>
                                <span>Messages</span>
                                <span class="badge bg-danger rounded-pill ms-auto">3</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'dashboard:calendar' %}">
                                <i class="bi bi-calendar-event"></i>
                                <span>Takvim</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'dashboard:files' %}">
                                <i class="bi bi-folder2-open"></i>
                                <span>Files</span>
                            </a>
                        </li>
                        <li class="nav-item mt-3">
                            <small class="text-muted px-3 text-uppercase fw-bold">Admin</small>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'dashboard:settings' %}">
                                <i class="bi bi-gear"></i>
                                <span>Settings</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'dashboard:security' %}">
                                <i class="bi bi-shield-check"></i>
                                <span>Security</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'dashboard:help' %}">
                                <i class="bi bi-question-circle"></i>
                                <span>Help & Support</span>
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>
        </aside>


        <!-- Main Content -->
        <main class="admin-main">
            <div class="container-fluid p-4 p-lg-5">
                {% block content %}
                {% endblock %}
            </div>
        </main>

        <!-- Footer -->
        <footer class="admin-footer">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-6">
                        <p class="mb-0 text-muted">© 2025 Mestakip</p>
                    </div>
                </div>
            </div>
        </footer>
        </div> <!-- /.admin-wrapper -->
    </div>

    <!-- Toast Container -->
    <div aria-live="polite" aria-atomic="true" class="position-fixed top-0 end-0 p-3" style="z-index: 11">
        <div id="toast-container"></div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Custom JS -->
    <script src="{% load static %}{% static 'main-f0Mg-34g.js' %}"></script>
    
    <!-- Page specific scripts -->
    {% block extra_js %}
    {% endblock %}
    
    <!-- Sidebar Toggle Script -->
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        console.log('Sidebar toggle script loaded');
        const toggleButton = document.querySelector('[data-sidebar-toggle]');
        const wrapper = document.getElementById('admin-wrapper');
        
        console.log('Toggle button found:', toggleButton);
        console.log('Wrapper found:', wrapper);

        if (toggleButton && wrapper) {
            // Set initial state from localStorage
            const isCollapsed = localStorage.getItem('sidebar-collapsed') === 'true';
            if (isCollapsed) {
                wrapper.classList.add('sidebar-collapsed');
            }

            // Attach click listener
            toggleButton.addEventListener('click', function(e) {
                e.preventDefault();
                const isCurrentlyCollapsed = wrapper.classList.contains('sidebar-collapsed');
                
                if (isCurrentlyCollapsed) {
                    // Show sidebar
                    wrapper.classList.remove('sidebar-collapsed');
                    localStorage.setItem('sidebar-collapsed', 'false');
                } else {
                    // Hide sidebar
                    wrapper.classList.add('sidebar-collapsed');
                    localStorage.setItem('sidebar-collapsed', 'true');
                }
            });
        }
    });
    </script>
    
    <!-- Theme Toggle Script -->
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const themeToggleButton = document.querySelector('[data-theme-toggle]');
        const htmlElement = document.documentElement;
        
        // Set initial theme from localStorage
        const savedTheme = localStorage.getItem('theme') || 'light';
        htmlElement.setAttribute('data-bs-theme', savedTheme);
        
        // Update button icon based on current theme
        updateThemeIcon(savedTheme);
        
        if (themeToggleButton) {
            themeToggleButton.addEventListener('click', function(e) {
                e.preventDefault();
                
                const currentTheme = htmlElement.getAttribute('data-bs-theme');
                const newTheme = currentTheme === 'light' ? 'dark' : 'light';
                
                // Apply new theme
                htmlElement.setAttribute('data-bs-theme', newTheme);
                localStorage.setItem('theme', newTheme);
                
                // Update button icon
                updateThemeIcon(newTheme);
                
                console.log('Theme changed to:', newTheme);
            });
        }
        
        function updateThemeIcon(theme) {
            if (themeToggleButton) {
                const icon = themeToggleButton.querySelector('i');
                if (icon) {
                    if (theme === 'light') {
                        icon.className = 'bi bi-sun-fill';
                    } else {
                        icon.className = 'bi bi-moon-fill';
                    }
                }
            }
        }
    });
    </script>
    
    <!-- Animation Keyframes -->
    <style>
    @keyframes slideInLeft {
        from {
            transform: translateX(-100%);
        }
        to {
            transform: translateX(0);
        }
    }
    
    @keyframes slideOutLeft {
        from {
            transform: translateX(0);
        }
        to {
            transform: translateX(-100%);
        }
    }
    </style>
    
    <!-- Dark Theme Styles -->
    <style>
    [data-bs-theme="dark"] {
        --bs-body-bg: #0f172a;
        --bs-body-color: #ffffff;
    }
    
    [data-bs-theme="dark"] .admin-main {
        background: #0f172a !important;
        color: #ffffff !important;
    }
    
    [data-bs-theme="dark"] .card {
        background-color: #1e293b !important;
        border-color: #334155 !important;
        color: #ffffff !important;
    }
    
    [data-bs-theme="dark"] .card-header {
        background-color: #334155 !important;
        border-bottom-color: #334155 !important;
        color: #ffffff !important;
    }
    
    [data-bs-theme="dark"] .table {
        color: #ffffff !important;
    }
    
    [data-bs-theme="dark"] .table-light {
        background-color: #334155 !important;
        color: #ffffff !important;
    }
    
    [data-bs-theme="dark"] .text-muted {
        color: #94a3b8 !important;
    }
    
    [data-bs-theme="dark"] .navbar {
        background-color: #1e293b !important;
        border-bottom-color: #334155 !important;
    }
    
    [data-bs-theme="dark"] .navbar-brand {
        color: #ffffff !important;
    }
    
    [data-bs-theme="dark"] .form-control {
        background-color: #334155 !important;
        border-color: #334155 !important;
        color: #ffffff !important;
    }
    
    [data-bs-theme="dark"] .form-control:focus {
        background-color: #334155 !important;
        border-color: #6366f1 !important;
        color: #ffffff !important;
        box-shadow: 0 0 0 0.2rem rgba(99, 102, 241, 0.25) !important;
    }
    
    [data-bs-theme="dark"] .btn-outline-secondary {
        color: #ffffff !important;
        border-color: #334155 !important;
    }
    
    [data-bs-theme="dark"] .btn-outline-secondary:hover {
        background-color: #334155 !important;
        border-color: #334155 !important;
        color: #ffffff !important;
    }
    
    [data-bs-theme="dark"] .dropdown-menu {
        background-color: #1e293b !important;
        border-color: #334155 !important;
    }
    
    [data-bs-theme="dark"] .dropdown-item {
        color: #ffffff !important;
    }
    
    [data-bs-theme="dark"] .dropdown-item:hover {
        background-color: #334155 !important;
        color: #ffffff !important;
    }
    
    [data-bs-theme="dark"] .admin-footer {
        background-color: #1e293b !important;
        color: #94a3b8 !important;
    }
    
    /* Dark theme chart colors */
    [data-bs-theme="dark"] .chart-container {
        background-color: #1e293b !important;
    }
    
    [data-bs-theme="dark"] canvas {
        filter: brightness(0.9) contrast(1.1);
    }
    </style>
</body>
</html>
