<!DOCTYPE html>
<html lang="en" data-bs-theme="light">

<head>
    <!-- Meta Tags -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Modern Bootstrap 5 Admin Template - Clean, responsive dashboard">
    <meta name="keywords" content="bootstrap, admin, dashboard, template, modern, responsive">
    <meta name="author" content="Bootstrap Admin Template">
    <meta name="csrf-token" content="{{ csrf_token }}">

    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="Mestakip">
    <meta property="og:description" content="Clean and modern admin dashboard template built with Bootstrap 5">
    <meta property="og:type" content="website">

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="{% load static %}{% static 'icons/favicon.svg' %}">
    <link rel="icon" type="image/png" href="{% load static %}{% static 'icons/favicon.png' %}">

    <!-- Preconnect to external domains -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Title -->
    <title>{% block title %}Dashboard - Mestakip{% endblock %}</title>

    <!-- Theme Color -->
    <meta name="theme-color" content="#6366f1">

    <!-- PWA Manifest -->
    <link rel="manifest" href="{% load static %}{% static 'manifest.json' %}">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="{% load static %}{% static 'main-DLfE7m78.css' %}">

    <!-- Override Bootstrap Icons font-face to use CDN fonts to avoid local font decode warnings -->
    <style>
        @font-face {
            font-family: "bootstrap-icons";
            src: url("https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/fonts/bootstrap-icons.woff2") format("woff2"),
                url("https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/fonts/bootstrap-icons.woff") format("woff");
            font-display: swap;
        }

        /* Finance Payment Fields Styles */
        .payment-field {
            transition: all 0.3s ease;
        }

        .payment-field:focus {
            box-shadow: 0 0 0 0.2rem rgba(40, 167, 69, 0.25);
        }

        .payment-field.selected {
            background-color: #e8f5e8 !important;
            border-color: #28a745 !important;
            box-shadow: 0 0 0 0.2rem rgba(40, 167, 69, 0.25);
        }

        .payment-field.focused {
            background-color: #f8f9fa !important;
        }
    </style>

    {% block extra_css %}{% endblock %}

    <!-- Sidebar Toggle Styles -->
    <style>
        .admin-wrapper {
            transition: all 0.3s ease;
        }

        .admin-sidebar {
            position: fixed;
            top: 0;
            left: 0;
            height: 100vh;
            background: #1f2937;
            z-index: 1000;
            overflow-y: auto;
            width: 250px;
            transition: width 0.3s ease;
        }

        .admin-sidebar .nav-link span {
            transition: opacity 0.3s ease;
        }

        .admin-sidebar .nav-link .badge {
            transition: opacity 0.3s ease;
        }

        .admin-sidebar .nav-link .ms-auto {
            transition: opacity 0.3s ease;
        }

        .admin-sidebar .text-muted {
            transition: opacity 0.3s ease;
        }

        .admin-main {
            margin-left: 250px;
            min-height: 100vh;
            background: #f8fafc;
            transition: margin-left 0.3s ease;
        }

        .admin-wrapper.sidebar-collapsed .admin-sidebar {
            width: 60px;
            overflow: hidden;
        }

        .admin-wrapper.sidebar-collapsed .admin-main {
            margin-left: 60px;
        }

        .admin-wrapper.sidebar-collapsed .admin-sidebar .nav-link span {
            opacity: 0;
            visibility: hidden;
        }

        .admin-wrapper.sidebar-collapsed .admin-sidebar .nav-link .badge {
            opacity: 0;
            visibility: hidden;
        }

        .admin-wrapper.sidebar-collapsed .admin-sidebar .nav-link .ms-auto {
            opacity: 0;
            visibility: hidden;
        }

        .admin-wrapper.sidebar-collapsed .admin-sidebar .text-muted {
            opacity: 0;
            visibility: hidden;
        }

        .admin-wrapper.sidebar-collapsed .admin-sidebar .nav-link {
            justify-content: center;
            padding: 0.75rem 0.5rem;
        }

        .admin-wrapper.sidebar-collapsed .admin-sidebar .nav-link i {
            margin-right: 0;
        }

        .admin-wrapper.sidebar-collapsed .admin-sidebar .navbar-brand {
            justify-content: center;
            padding: 1rem 0.5rem;
        }

        .admin-wrapper.sidebar-collapsed .admin-sidebar .navbar-brand h1 {
            display: none;
        }

        .admin-wrapper.sidebar-collapsed .admin-sidebar .navbar-brand img {
            margin-right: 0;
        }

        .admin-wrapper.sidebar-collapsed .admin-sidebar .sidebar-header {
            justify-content: center;
            padding: 1rem 0.5rem;
        }

        /* Hide toggle button when sidebar is collapsed (Railway style) */
        .admin-wrapper.sidebar-collapsed .sidebar-toggle-btn {
            display: none !important;
        }

        /* Hide unwanted toast notifications (CSS fallback) */
        .toast-body:has(span:contains("Application loaded successfully")),
        .toast:has(.toast-body span:contains("Application loaded successfully")) {
            display: none !important;
        }

        .admin-sidebar .sidebar-header .sidebar-toggle-btn,
        .sidebar-toggle-btn {
            display: flex !important;
            background: #6366f1 !important;
            border: 2px solid #4f46e5 !important;
            color: white !important;
            padding: 0.75rem !important;
            border-radius: 8px !important;
            transition: all 0.3s ease !important;
            min-width: 50px !important;
            height: 50px !important;
            align-items: center !important;
            justify-content: center !important;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2) !important;
            cursor: pointer !important;
            font-size: 1rem !important;
            position: relative !important;
            z-index: 1000 !important;
            margin: 0 !important;
            font-family: inherit !important;
            line-height: 1.5 !important;
            text-align: center !important;
            text-decoration: none !important;
            vertical-align: middle !important;
            user-select: none !important;
        }

        .admin-sidebar .sidebar-header .sidebar-toggle-btn:hover,
        .sidebar-toggle-btn:hover {
            background: #4f46e5 !important;
            border-color: #3730a3 !important;
            color: white !important;
            transform: scale(1.05) !important;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3) !important;
        }

        .admin-sidebar .sidebar-header .sidebar-toggle-btn i,
        .sidebar-toggle-btn i {
            font-size: 1.2rem !important;
            font-weight: bold !important;
            color: white !important;
        }

        /* Mobile Responsive Styles */
        @media (max-width: 768px) {

            /* Sidebar Mobile AyarlarÄ± */
            .admin-sidebar {
                transform: translateX(-100%);
                z-index: 1050;
                position: fixed;
                width: 280px;
            }

            .admin-main {
                margin-left: 0;
                padding: 1rem;
            }

            .admin-wrapper.sidebar-collapsed .admin-sidebar {
                transform: translateX(-100%);
            }

            /* Navbar Mobile AyarlarÄ± */
            .navbar .container-fluid {
                padding: 0.5rem 1rem;
            }

            .navbar-brand h1 {
                font-size: 1.2rem;
            }

            .search-container {
                display: none;
                /* Mobilde arama Ã§ubuÄŸunu gizle */
            }

            .navbar-nav.flex-row {
                gap: 0.5rem;
            }

            .navbar-nav .btn {
                padding: 0.5rem;
                font-size: 0.9rem;
            }

            /* Dashboard Mobile AyarlarÄ± */
            .d-flex.justify-content-between.align-items-center {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }

            .d-flex.gap-2 {
                width: 100%;
                justify-content: space-between;
                flex-wrap: wrap;
            }

            .d-flex.gap-2 .btn {
                flex: 1;
                min-width: 120px;
                font-size: 0.85rem;
                padding: 0.5rem 0.75rem;
            }

            /* Stats Cards Mobile */
            .stats-card .card-body {
                padding: 1rem;
            }

            .stats-icon {
                width: 40px;
                height: 40px;
            }

            .stats-card h3 {
                font-size: 1.5rem;
            }

            /* Table Mobile AyarlarÄ± */
            .table-responsive {
                font-size: 0.85rem;
            }

            .table th,
            .table td {
                padding: 0.5rem 0.25rem;
                white-space: nowrap;
            }

            /* Card Mobile AyarlarÄ± */
            .card {
                margin-bottom: 1rem;
            }

            .card-header {
                padding: 0.75rem 1rem;
            }

            .card-body {
                padding: 1rem;
            }

            /* Form Mobile AyarlarÄ± */
            .form-control,
            .form-select {
                font-size: 16px;
                /* iOS zoom Ã¶nleme */
            }

            /* Modal Mobile AyarlarÄ± */
            .modal-dialog {
                margin: 0.5rem;
                max-width: calc(100% - 1rem);
            }

            .modal-body {
                padding: 1rem;
            }

            /* Bildirim Dropdown Mobile */
            .dropdown-menu {
                width: 300px !important;
                max-width: calc(100vw - 2rem);
                left: auto !important;
                right: 0 !important;
            }

            .notification-item {
                padding: 0.75rem;
            }

            .notification-title {
                font-size: 0.9rem;
            }

            .notification-message {
                font-size: 0.8rem;
            }
        }

        /* Tablet Responsive Styles */
        @media (max-width: 1024px) and (min-width: 769px) {
            .admin-sidebar {
                width: 220px;
            }

            .admin-main {
                margin-left: 220px;
            }

            .admin-wrapper.sidebar-collapsed .admin-main {
                margin-left: 60px;
            }

            .search-container {
                max-width: 300px;
            }

            .d-flex.gap-2 .btn {
                font-size: 0.9rem;
                padding: 0.6rem 1rem;
            }
        }

        /* Extra Small Mobile (iPhone SE, etc.) */
        @media (max-width: 480px) {
            .admin-main {
                padding: 0.5rem;
            }

            .navbar-brand h1 {
                font-size: 1rem;
            }

            .d-flex.gap-2 .btn {
                font-size: 0.8rem;
                padding: 0.4rem 0.6rem;
                min-width: 100px;
            }

            .stats-card h3 {
                font-size: 1.3rem;
            }

            .card-header h5 {
                font-size: 1rem;
            }

            .table-responsive {
                font-size: 0.8rem;
            }

            .dropdown-menu {
                width: 280px !important;
            }
        }

        /* Landscape Mobile */
        @media (max-width: 768px) and (orientation: landscape) {
            .admin-main {
                padding: 0.5rem;
            }

            .stats-card .card-body {
                padding: 0.75rem;
            }

            .d-flex.justify-content-between.align-items-center {
                flex-direction: row;
                align-items: center;
            }

            .d-flex.gap-2 {
                width: auto;
            }
        }

        /* Touch Device Optimizations */
        @media (hover: none) and (pointer: coarse) {
            .btn {
                min-height: 44px;
                /* Apple touch target minimum */
            }

            .nav-link {
                min-height: 44px;
                display: flex;
                align-items: center;
            }

            .dropdown-item {
                min-height: 44px;
                display: flex;
                align-items: center;
            }

            .notification-item {
                min-height: 60px;
            }
        }
    </style>
</head>

<body data-page="{% block page_name %}dashboard{% endblock %}" class="admin-layout">
    <!-- Main Wrapper -->
    <div class="admin-wrapper" id="admin-wrapper">

        <!-- Header -->
        <header class="admin-header">
            <nav class="navbar navbar-expand-lg navbar-light bg-white border-bottom">
                <div class="container-fluid">
                    <!-- Mobile Sidebar Toggle (sadece mobilde gÃ¶rÃ¼nÃ¼r) -->
                    <button class="btn btn-outline-primary d-lg-none me-2" type="button" onclick="toggleMobileSidebar()"
                        aria-label="Toggle sidebar">
                        <i class="bi bi-list"></i>
                    </button>

                    <!-- Logo/Brand - Now first on the left -->
                    <a class="navbar-brand d-flex align-items-center" href="{% url 'dashboard:index' %}">
                        <img src="{% load static %}{% static 'images/logo.svg' %}" alt="Logo" height="32"
                            class="d-inline-block align-text-top me-2">
                       
                    </a>

                    <!-- Search Bar -->
                    <div class="search-container flex-grow-1 mx-4">
                        <div class="position-relative">
                            <input type="search" class="form-control" placeholder="Search... (Ctrl+K)" data-search-input
                                aria-label="Search">
                            <i class="bi bi-search position-absolute top-50 end-0 translate-middle-y me-3"></i>
                        </div>
                    </div>

                    <!-- Right Side Icons -->
                    <div class="navbar-nav flex-row">
                        <!-- Theme Toggle -->
                        <button class="btn btn-outline-secondary me-2" type="button" data-theme-toggle
                            data-bs-toggle="tooltip" data-bs-placement="bottom" title="Toggle theme">
                            <i class="bi bi-sun-fill"></i>
                        </button>

                        <!-- Fullscreen Toggle -->
                        <button class="btn btn-outline-secondary me-2" type="button" data-fullscreen-toggle
                            data-bs-toggle="tooltip" data-bs-placement="bottom" title="Toggle fullscreen">
                            <i class="bi bi-arrows-fullscreen icon-hover"></i>
                        </button>

                        <!-- Notifications -->
                        <div class="dropdown me-2">
                            <button class="btn btn-outline-secondary position-relative" type="button"
                                data-bs-toggle="dropdown" data-bs-auto-close="outside" aria-expanded="false"
                                id="notificationButton">
                                <i class="bi bi-bell"></i>
                                <span
                                    class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger"
                                    id="notificationBadge" style="display: none;">
                                    0
                                </span>
                            </button>
                            <ul class="dropdown-menu dropdown-menu-end" id="notificationDropdownMenu"
                                aria-labelledby="notificationButton"
                                style="width: 350px; max-height: 400px; overflow-y: auto;">
                                <li class="dropdown-header d-flex justify-content-between align-items-center">
                                    <span>Bildirimler</span>
                                    <button class="btn btn-sm btn-link text-primary p-0" id="markAllReadBtn"
                                        style="font-size: 0.75rem;" type="button">
                                        TÃ¼mÃ¼nÃ¼ Okundu Ä°ÅŸaretle
                                    </button>
                                </li>
                                <li>
                                    <hr class="dropdown-divider">
                                </li>
                                <div id="notificationList">
                                    <li class="dropdown-item text-center text-muted py-3">
                                        <i class="bi bi-bell-slash fs-4 d-block mb-2"></i>
                                        HenÃ¼z bildirim yok
                                    </li>
                                </div>
                            </ul>
                        </div>

                        <!-- User Menu -->
                        {% if user.is_authenticated %}
                        <div class="dropdown">
                            <button class="btn btn-outline-secondary d-flex align-items-center" type="button"
                                data-bs-toggle="dropdown" data-bs-auto-close="true" aria-expanded="false"
                                id="userMenuButton">
                                <img src="{% load static %}{% static 'images/avatar-placeholder.svg' %}"
                                    alt="User Avatar" width="24" height="24" class="rounded-circle me-2">
                                <span class="d-none d-md-inline">
                                    {% if user.first_name and user.last_name %}
                                    {{ user.first_name }} {{ user.last_name }}
                                    {% elif user.first_name %}
                                    {{ user.first_name }}
                                    {% else %}
                                    {{ user.username }}
                                    {% endif %}
                                </span>
                                <i class="bi bi-chevron-down ms-1"></i>
                            </button>
                            <ul class="dropdown-menu dropdown-menu-end" id="userMenuDropdown"
                                aria-labelledby="userMenuButton">
                                <li>
                                    <h6 class="dropdown-header">
                                        {% if user.first_name and user.last_name %}
                                        {{ user.first_name }} {{ user.last_name }}
                                        {% elif user.first_name %}
                                        {{ user.first_name }}
                                        {% else %}
                                        {{ user.username }}
                                        {% endif %}
                                        <br><small class="text-muted">
                                            {% if user.userprofile.role == 'admin' %}
                                            <span class="badge bg-danger">Admin</span>
                                            {% else %}
                                            <span class="badge bg-info">YÃ¶netici</span>
                                            {% endif %}
                                        </small>
                                    </h6>
                                </li>
                                <li>
                                    <hr class="dropdown-divider">
                                </li>
                                <li><a class="dropdown-item" href="#"><i class="bi bi-person me-2"></i>Profil</a></li>
                                <li><a class="dropdown-item" href="#"><i class="bi bi-gear me-2"></i>Ayarlar</a></li>
                                <li>
                                    <hr class="dropdown-divider">
                                </li>
                                <li><a class="dropdown-item" href="{% url 'dashboard:logout' %}"><i
                                            class="bi bi-box-arrow-right me-2"></i>Ã‡Ä±kÄ±ÅŸ Yap</a></li>
                            </ul>
                        </div>
                        {% else %}
                        <div class="d-flex gap-2">
                            <a href="{% url 'dashboard:login' %}" class="btn btn-primary">
                                <i class="bi bi-box-arrow-in-right me-1"></i>
                                GiriÅŸ Yap
                            </a>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </nav>
        </header>

        <!-- Sidebar -->
        <aside class="admin-sidebar" id="admin-sidebar">
            <div class="sidebar-content">
                <!-- Sidebar Header -->
                <div class="sidebar-header d-flex align-items-center justify-content-between p-3">
                    <a class="navbar-brand d-flex align-items-center" href="{% url 'dashboard:index' %}">
                        <img src="{% load static %}{% static 'images/logo.svg' %}" alt="Logo" height="32"
                            class="d-inline-block align-text-top me-2">
                        <h1 class="h4 mb-0 fw-bold text-white">MesTakip</h1>
                    </a>
                    <button class="sidebar-toggle-btn" type="button" data-sidebar-toggle aria-label="Toggle sidebar"
                        title="Toggle Sidebar">
                        <i class="bi bi-list"></i>
                    </button>
                </div>

                <nav class="sidebar-nav">
                    <ul class="nav flex-column">
                        <!-- Ana -->
                        <li class="nav-item">
                            <a class="nav-link {% if request.resolver_match.url_name == 'index' %}active{% endif %}"
                                href="{% url 'dashboard:index' %}">
                                <i class="bi bi-speedometer2"></i>
                                <span>Dashboard</span>
                            </a>
                        </li>
                       

                        <!-- SipariÅŸler -->
                        <li class="nav-item mt-3">
                            <small class="text-muted px-3 text-uppercase fw-bold">SipariÅŸler</small>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" data-bs-toggle="collapse" data-bs-target="#sidebarOrders" href="#" role="button" aria-expanded="false" aria-controls="sidebarOrders">
                                <i class="bi bi-box-seam"></i>
                                <span>SipariÅŸ YÃ¶netimi</span>
                                <i class="bi bi-chevron-down ms-auto"></i>
                            </a>
                            <div class="collapse" id="sidebarOrders">
                                <ul class="nav flex-column ms-3 my-2">
                                    <li class="nav-item"><a class="nav-link" href="{% url 'dashboard:analytics' %}"><span>Analist</span></a></li>
                                    <li class="nav-item"><a class="nav-link" href="{% url 'dashboard:elements' %}"><span>Envanter</span></a></li>
                                    <li class="nav-item"><a class="nav-link" href="{% url 'dashboard:forms' %}"><span>Kontrol Edilen</span></a></li>
                                    <li class="nav-item"><a class="nav-link" href="{% url 'dashboard:reports' %}"><span>Ä°ptal Raporu</span></a></li>
                                </ul>
                            </div>
                        </li>

                        <!-- Finance -->
                        <li class="nav-item mt-3">
                            <small class="text-muted px-3 text-uppercase fw-bold">Finance</small>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" data-bs-toggle="collapse" data-bs-target="#sidebarFinance" href="#" role="button" aria-expanded="false" aria-controls="sidebarFinance">
                                <i class="bi bi-cash-coin"></i>
                                <span>Gelir/Gider</span>
                                <i class="bi bi-chevron-down ms-auto"></i>
                            </a>
                            <div class="collapse" id="sidebarFinance">
                                <ul class="nav flex-column ms-3 my-2">
                                    <li class="nav-item"><a class="nav-link" href="{% url 'dashboard:products' %}"><span>Rapor Hareketleri</span></a></li>
                                    <li class="nav-item"><a class="nav-link" href="{% url 'dashboard:finance' %}"><span>Ä°ÅŸlem Ekle</span></a></li>
                                    <li class="nav-item"><a class="nav-link" href="{% url 'dashboard:messages' %}"><span>Rapor ToplamlarÄ±</span></a></li>
                                    <li class="nav-item"><a class="nav-link" href="{% url 'dashboard:kategoriler' %}"><span>Kategoriler</span></a></li>
                                </ul>
                            </div>
                        </li>

                        <!-- DiÄŸer -->
                        <li class="nav-item mt-3">
                            <small class="text-muted px-3 text-uppercase fw-bold">DiÄŸer</small>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'dashboard:calendar' %}">
                                <i class="bi bi-calendar-event"></i>
                                <span>Takvim</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'dashboard:users' %}">
                                <i class="bi bi-people"></i>
                                <span>KullanÄ±cÄ±lar</span>
                            </a>
                        </li>

                        <li class="nav-item mt-3">
                            <small class="text-muted px-3 text-uppercase fw-bold">Admin</small>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'dashboard:settings' %}">
                                <i class="bi bi-gear"></i>
                                <span>Settings</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'dashboard:security' %}">
                                <i class="bi bi-shield-check"></i>
                                <span>Security</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'dashboard:help' %}">
                                <i class="bi bi-question-circle"></i>
                                <span>Help & Support</span>
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>
        </aside>


        <!-- Main Content -->
        <main class="admin-main">
            <div class="container-fluid p-4 p-lg-5">
                {% block content %}
                {% endblock %}
            </div>
        </main>

        <!-- Footer -->
        <footer class="admin-footer">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-6">
                        <p class="mb-0 text-muted">Â© 2025 Mestakip</p>
                    </div>
                </div>
            </div>
        </footer>
    </div> <!-- /.admin-wrapper -->
    </div>

    <!-- Toast Container -->
    <div aria-live="polite" aria-atomic="true" class="position-fixed top-0 end-0 p-3" style="z-index: 11">
        <div id="toast-container"></div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Chart.js Configuration -->
    <script>
        // Ensure Chart.js is properly configured
        if (typeof Chart !== 'undefined') {
            // Chart.js v4+ has Filler plugin built-in, just need to ensure defaults are set
            Chart.defaults.elements.line.fill = false; // Disable fill by default to avoid warnings
            console.log('Chart.js loaded successfully, version:', Chart.version);
        }
    </script>

    <!-- Suppress unwanted toast notifications and console messages - MUST BE BEFORE main.js -->
    <script>
        // Hide unwanted toast notifications
        (function () {
            // MutationObserver to watch for toast notifications
            const observer = new MutationObserver(function (mutations) {
                mutations.forEach(function (mutation) {
                    mutation.addedNodes.forEach(function (node) {
                        if (node.nodeType === 1) { // Element node
                            // Check if it's a toast with unwanted message
                            const toastBody = node.querySelector('.toast-body');
                            if (toastBody) {
                                const text = toastBody.textContent || toastBody.innerText;
                                if (text.includes('Application loaded successfully') ||
                                    text.includes('Admin App initialized') ||
                                    text.includes('Dashboard Manager initialized')) {
                                    // Remove the toast immediately
                                    node.remove();
                                    console.log('ðŸ”‡ Blocked unwanted toast notification');
                                }
                            }
                        }
                    });
                });
            });

            // Start observing when DOM is ready
            if (document.body) {
                observer.observe(document.body, {
                    childList: true,
                    subtree: true
                });
            } else {
                document.addEventListener('DOMContentLoaded', function () {
                    observer.observe(document.body, {
                        childList: true,
                        subtree: true
                    });
                });
            }
        })();

        // Override console methods to filter out unwanted messages
        (function () {
            const originalLog = console.log;
            const originalInfo = console.info;
            const originalDebug = console.debug;
            const originalWarn = console.warn;

            // List of unwanted message patterns
            const blockedPatterns = [
                'Application loaded successfully',
                'application loaded successfully',
                'App loaded successfully',
                'Admin App initialized',
                'admin app initialized',
                'Dashboard Manager initialized',
                'Advanced Dashboard Manager',
                'dashboard manager',
                'ðŸš€',
                'loaded successfully',
                'initialized successfully'
            ];

            // Check if message should be blocked
            function shouldBlock(message) {
                const msgStr = String(message).toLowerCase();
                return blockedPatterns.some(pattern =>
                    msgStr.includes(pattern.toLowerCase())
                );
            }

            // Override console.log
            console.log = function (...args) {
                const message = args.join(' ');
                if (shouldBlock(message)) {
                    return; // Block this message
                }
                originalLog.apply(console, args);
            };

            // Override console.info
            console.info = function (...args) {
                const message = args.join(' ');
                if (shouldBlock(message)) {
                    return; // Block this message
                }
                originalInfo.apply(console, args);
            };

            // Override console.debug
            console.debug = function (...args) {
                const message = args.join(' ');
                if (shouldBlock(message)) {
                    return; // Block this message
                }
                originalDebug.apply(console, args);
            };

            // Override console.warn (optional)
            console.warn = function (...args) {
                const message = args.join(' ');
                if (shouldBlock(message)) {
                    return; // Block this message
                }
                originalWarn.apply(console, args);
            };

            // Log that filter is active
            originalLog('%cðŸ”‡ Console Filter Active', 'color: #888; font-style: italic;');
        })();
    </script>

    <!-- Custom JS (ES Module build) -->
    <script type="module" src="{% load static %}{% static 'main-f0Mg-34g.js' %}"></script>

    <!-- Page specific scripts -->
    {% block extra_js %}
    {% endblock %}

    <!-- Sidebar Toggle Script -->
    <script>
        // FORCE RESET: Sidebar aÃ§Ä±k olsun (bu satÄ±rÄ± bir kez Ã§alÄ±ÅŸtÄ±rÄ±n, sonra silin)
        localStorage.setItem('sidebar-collapsed', 'false');

        document.addEventListener('DOMContentLoaded', function () {
            console.log('Sidebar toggle script loaded');
            const toggleButton = document.querySelector('[data-sidebar-toggle]');
            const wrapper = document.getElementById('admin-wrapper');

            console.log('Toggle button found:', toggleButton);
            console.log('Wrapper found:', wrapper);

            if (toggleButton && wrapper) {
                // Set initial state from localStorage (default: open/false)
                const savedState = localStorage.getItem('sidebar-collapsed');

                // If no saved state, default to open (false)
                // If saved state is 'true', collapse the sidebar
                if (savedState === 'true') {
                    wrapper.classList.add('sidebar-collapsed');
                } else {
                    // Ensure sidebar is open by default
                    wrapper.classList.remove('sidebar-collapsed');
                    // Set default state if not set
                    if (savedState === null) {
                        localStorage.setItem('sidebar-collapsed', 'false');
                    }
                }

                // Attach click listener
                toggleButton.addEventListener('click', function (e) {
                    e.preventDefault();
                    const isCurrentlyCollapsed = wrapper.classList.contains('sidebar-collapsed');

                    if (isCurrentlyCollapsed) {
                        // Show sidebar
                        wrapper.classList.remove('sidebar-collapsed');
                        localStorage.setItem('sidebar-collapsed', 'false');
                    } else {
                        // Hide sidebar
                        wrapper.classList.add('sidebar-collapsed');
                        localStorage.setItem('sidebar-collapsed', 'true');
                    }
                });

                // Logo'ya tÄ±klayÄ±nca sidebar'Ä± aÃ§ (Railway style)
                const logo = document.querySelector('.admin-sidebar .navbar-brand');
                if (logo) {
                    logo.addEventListener('click', function (e) {
                        const isCurrentlyCollapsed = wrapper.classList.contains('sidebar-collapsed');

                        if (isCurrentlyCollapsed) {
                            e.preventDefault();
                            // Show sidebar
                            wrapper.classList.remove('sidebar-collapsed');
                            localStorage.setItem('sidebar-collapsed', 'false');
                            console.log('Sidebar opened via logo click');
                        }
                        // EÄŸer sidebar aÃ§Ä±ksa, normal link davranÄ±ÅŸÄ± (dashboard'a git)
                    });
                }
            }
        });
    </script>

    <!-- Theme Toggle Script -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const themeToggleButton = document.querySelector('[data-theme-toggle]');
            const htmlElement = document.documentElement;

            // Set initial theme from localStorage
            const savedTheme = localStorage.getItem('theme') || 'light';
            htmlElement.setAttribute('data-bs-theme', savedTheme);

            // Update button icon based on current theme
            updateThemeIcon(savedTheme);

            if (themeToggleButton) {
                themeToggleButton.addEventListener('click', function (e) {
                    e.preventDefault();

                    const currentTheme = htmlElement.getAttribute('data-bs-theme');
                    const newTheme = currentTheme === 'light' ? 'dark' : 'light';

                    // Apply new theme
                    htmlElement.setAttribute('data-bs-theme', newTheme);
                    localStorage.setItem('theme', newTheme);

                    // Update button icon
                    updateThemeIcon(newTheme);

                    console.log('Theme changed to:', newTheme);
                });
            }

            function updateThemeIcon(theme) {
                if (themeToggleButton) {
                    const icon = themeToggleButton.querySelector('i');
                    if (icon) {
                        if (theme === 'light') {
                            icon.className = 'bi bi-sun-fill';
                        } else {
                            icon.className = 'bi bi-moon-fill';
                        }
                    }
                }
            }
        });
    </script>

    <!-- Fullscreen Toggle Script -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const fullscreenToggleButton = document.querySelector('[data-fullscreen-toggle]');

            if (fullscreenToggleButton) {
                fullscreenToggleButton.addEventListener('click', function () {
                    toggleFullscreen();
                });
            }

            function toggleFullscreen() {
                if (!document.fullscreenElement) {
                    // Tam ekrana geÃ§
                    document.documentElement.requestFullscreen().then(() => {
                        updateFullscreenIcon(true);
                    }).catch(err => {
                        console.log('Tam ekran modu desteklenmiyor:', err);
                    });
                } else {
                    // Tam ekrandan Ã§Ä±k
                    document.exitFullscreen().then(() => {
                        updateFullscreenIcon(false);
                    }).catch(err => {
                        console.log('Tam ekrandan Ã§Ä±kma hatasÄ±:', err);
                    });
                }
            }

            function updateFullscreenIcon(isFullscreen) {
                const icon = fullscreenToggleButton?.querySelector('i');
                if (icon) {
                    if (isFullscreen) {
                        icon.className = 'bi bi-fullscreen-exit icon-hover';
                        fullscreenToggleButton.setAttribute('title', 'Tam Ekrandan Ã‡Ä±k');
                    } else {
                        icon.className = 'bi bi-arrows-fullscreen icon-hover';
                        fullscreenToggleButton.setAttribute('title', 'Tam Ekran');
                    }
                }
            }

            // Fullscreen deÄŸiÅŸikliklerini dinle (ESC tuÅŸu vs.)
            document.addEventListener('fullscreenchange', function () {
                updateFullscreenIcon(!!document.fullscreenElement);
            });
        });
    </script>

    <!-- Animation Keyframes -->
    <style>
        @keyframes slideInLeft {
            from {
                transform: translateX(-100%);
            }

            to {
                transform: translateX(0);
            }
        }

        @keyframes slideOutLeft {
            from {
                transform: translateX(0);
            }

            to {
                transform: translateX(-100%);
            }
        }
    </style>

    <!-- Dark Theme Styles -->
    <style>
        [data-bs-theme="dark"] {
            --bs-body-bg: #0f172a;
            --bs-body-color: #ffffff;
        }

        [data-bs-theme="dark"] .admin-main {
            background: #0f172a !important;
            color: #ffffff !important;
        }

        [data-bs-theme="dark"] .card {
            background-color: #1e293b !important;
            border-color: #334155 !important;
            color: #ffffff !important;
        }

        [data-bs-theme="dark"] .card-header {
            background-color: #334155 !important;
            border-bottom-color: #334155 !important;
            color: #ffffff !important;
        }

        [data-bs-theme="dark"] .table {
            color: #ffffff !important;
        }

        [data-bs-theme="dark"] .table-light {
            background-color: #334155 !important;
            color: #ffffff !important;
        }

        [data-bs-theme="dark"] .text-muted {
            color: #94a3b8 !important;
        }

        [data-bs-theme="dark"] .navbar {
            background-color: #1e293b !important;
            border-bottom-color: #334155 !important;
        }

        [data-bs-theme="dark"] .navbar-brand {
            color: #ffffff !important;
        }

        [data-bs-theme="dark"] .form-control {
            background-color: #334155 !important;
            border-color: #334155 !important;
            color: #ffffff !important;
        }

        [data-bs-theme="dark"] .form-control:focus {
            background-color: #334155 !important;
            border-color: #6366f1 !important;
            color: #ffffff !important;
            box-shadow: 0 0 0 0.2rem rgba(99, 102, 241, 0.25) !important;
        }

        [data-bs-theme="dark"] .btn-outline-secondary {
            color: #ffffff !important;
            border-color: #334155 !important;
        }

        [data-bs-theme="dark"] .btn-outline-secondary:hover {
            background-color: #334155 !important;
            border-color: #334155 !important;
            color: #ffffff !important;
        }

        [data-bs-theme="dark"] .dropdown-menu {
            background-color: #1e293b !important;
            border-color: #334155 !important;
        }

        [data-bs-theme="dark"] .dropdown-item {
            color: #ffffff !important;
        }

        [data-bs-theme="dark"] .dropdown-item:hover {
            background-color: #334155 !important;
            color: #ffffff !important;
        }

        [data-bs-theme="dark"] .admin-footer {
            background-color: #1e293b !important;
            color: #94a3b8 !important;
        }

        /* Dark theme chart colors */
        [data-bs-theme="dark"] .chart-container {
            background-color: #1e293b !important;
        }

        [data-bs-theme="dark"] canvas {
            filter: brightness(0.9) contrast(1.1);
        }

        /* Header - Fixed at top */
        .admin-header {
            position: sticky;
            top: 0;
            z-index: 1000;
            background: white;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        /* Bildirim dropdown */
        .dropdown-menu {
            z-index: 1050;
        }

        .notification-item {
            padding: 12px 16px;
            border-bottom: 1px solid #e2e8f0;
            cursor: pointer;
            transition: background-color 0.2s;
            display: block;
        }

        .notification-item:hover {
            background-color: #f8fafc;
        }

        .notification-item.unread {
            background-color: #eff6ff;
            border-left: 3px solid #3b82f6;
        }

        #notificationList {
            padding: 0;
            margin: 0;
        }

        .notification-icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            color: white;
            margin-right: 12px;
        }

        .notification-content {
            flex: 1;
        }

        .notification-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 4px;
            color: #1e293b;
        }

        .notification-message {
            font-size: 13px;
            color: #64748b;
            margin-bottom: 4px;
            line-height: 1.4;
        }

        .notification-time {
            font-size: 11px;
            color: #94a3b8;
        }

        .notification-actions {
            display: flex;
            gap: 8px;
            margin-top: 8px;
        }

        .notification-actions .btn {
            font-size: 11px;
            padding: 2px 8px;
        }

        [data-bs-theme="dark"] .notification-item {
            border-bottom-color: #334155;
        }

        [data-bs-theme="dark"] .notification-item:hover {
            background-color: #334155;
        }

        [data-bs-theme="dark"] .notification-item.unread {
            background-color: #1e3a8a;
            border-left-color: #3b82f6;
        }

        [data-bs-theme="dark"] .notification-title {
            color: #ffffff;
        }

        [data-bs-theme="dark"] .notification-message {
            color: #cbd5e1;
        }

        [data-bs-theme="dark"] .notification-time {
            color: #94a3b8;
        }
    </style>

    <!-- Bildirim Sistemi JavaScript -->
    <script>
        class NotificationSystem {
            constructor() {
                this.notifications = [];
                this.unreadCount = 0;
                this.checkInterval = 5000; // 5 saniye - hatÄ±rlatÄ±cÄ±lar iÃ§in daha sÄ±k kontrol (daha hassas)
                this.init();
            }

            init() {
                this.loadNotifications();
                this.setupEventListeners();
                this.startPeriodicCheck();
            }

            setupEventListeners() {
                // TÃ¼mÃ¼nÃ¼ okundu iÅŸaretle butonu
                const markAllReadBtn = document.getElementById('markAllReadBtn');
                if (markAllReadBtn) {
                    markAllReadBtn.addEventListener('click', (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        this.markAllAsRead();
                    });
                }
            }

            async loadNotifications() {
                try {
                    const response = await fetch('/dashboard/api/notifications/');
                    const data = await response.json();

                    if (data.success) {
                        // Ã–nceki bildirimlerin "shown" durumunu koru
                        const previousNotifications = this.notifications.reduce((acc, notif) => {
                            acc[notif.id] = notif.shown || false;
                            return acc;
                        }, {});
                        
                        const oldNotificationIds = new Set(this.notifications.map(n => n.id));
                        const newNotifications = data.notifications.map(notif => ({
                            ...notif,
                            shown: previousNotifications[notif.id] || false
                        }));
                        
                        // Yeni eklenen bildirimleri kontrol et
                        const newlyAdded = newNotifications.filter(n => !oldNotificationIds.has(n.id));
                        
                        this.notifications = newNotifications;
                        this.unreadCount = data.unread_count;
                        this.updateUI();
                        
                        // Yeni eklenen event_created bildirimlerini hemen gÃ¶ster
                        newlyAdded.forEach(notification => {
                            if (notification.type === 'event_created' && notification.status === 'sent') {
                                console.log('ðŸŽ‰ Yeni etkinlik bildirimi bulundu:', notification.title);
                                // Hemen gÃ¶ster
                                setTimeout(() => {
                                    this.showToast(
                                        `${notification.title}\n${notification.message}`,
                                        'info'
                                    );
                                    notification.shown = true;
                                }, 100);
                            }
                        });
                        
                        // Yeni yÃ¼klenen bildirimlerde hatÄ±rlatÄ±cÄ±larÄ± kontrol et
                        this.checkReminders();
                    }
                } catch (error) {
                    console.error('Bildirimler yÃ¼klenirken hata:', error);
                }
            }

            updateUI() {
                this.updateBadge();
                this.updateNotificationList();
            }

            updateBadge() {
                const badge = document.getElementById('notificationBadge');
                if (badge) {
                    if (this.unreadCount > 0) {
                        badge.textContent = this.unreadCount;
                        badge.style.display = 'block';
                    } else {
                        badge.style.display = 'none';
                    }
                }
            }

            updateNotificationList() {
                const listContainer = document.getElementById('notificationList');
                if (!listContainer) return;

                if (this.notifications.length === 0) {
                    listContainer.innerHTML = `
                    <div class="dropdown-item text-center text-muted py-3">
                        <i class="bi bi-bell-slash fs-4 d-block mb-2"></i>
                        HenÃ¼z bildirim yok
                    </div>
                `;
                    return;
                }

                let html = '';
                this.notifications.forEach(notification => {
                    const isUnread = notification.status === 'pending' || notification.status === 'sent';
                    const timeAgo = this.getTimeAgo(notification.scheduled_time);

                    html += `
                    <div class="notification-item ${isUnread ? 'unread' : ''}" 
                        data-notification-id="${notification.id}">
                        <div class="d-flex">
                            <div class="notification-icon" style="background-color: ${notification.color}">
                                <i class="${notification.icon}"></i>
                            </div>
                            <div class="notification-content">
                                <div class="notification-title">${notification.title}</div>
                                <div class="notification-message">${notification.message}</div>
                                <div class="notification-time">${timeAgo}</div>
                                ${isUnread ? `
                                    <div class="notification-actions">
                                        <button class="btn btn-sm btn-primary" onclick="notificationSystem.markAsRead(${notification.id})">
                                            Okundu Ä°ÅŸaretle
                                        </button>
                                        <button class="btn btn-sm btn-outline-secondary" onclick="notificationSystem.dismiss(${notification.id})">
                                            Kapat
                                        </button>
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                `;
                });

                listContainer.innerHTML = html;
            }

            async markAsRead(notificationId) {
                try {
                    const response = await fetch(`/dashboard/api/notifications/${notificationId}/read/`, {
                        method: 'POST',
                        headers: {
                            'X-CSRFToken': this.getCSRFToken(),
                            'Content-Type': 'application/json'
                        }
                    });

                    const data = await response.json();
                    if (data.success) {
                        this.loadNotifications();
                        this.showToast('Bildirim okundu olarak iÅŸaretlendi', 'success');
                    }
                } catch (error) {
                    console.error('Bildirim iÅŸaretlenirken hata:', error);
                    this.showToast('Bir hata oluÅŸtu', 'error');
                }
            }

            async markAllAsRead() {
                try {
                    const response = await fetch('/dashboard/api/notifications/read-all/', {
                        method: 'POST',
                        headers: {
                            'X-CSRFToken': this.getCSRFToken(),
                            'Content-Type': 'application/json'
                        }
                    });

                    const data = await response.json();
                    if (data.success) {
                        this.loadNotifications();
                        this.showToast(data.message, 'success');
                    }
                } catch (error) {
                    console.error('Bildirimler iÅŸaretlenirken hata:', error);
                    this.showToast('Bir hata oluÅŸtu', 'error');
                }
            }

            async dismiss(notificationId) {
                try {
                    const response = await fetch(`/dashboard/api/notifications/${notificationId}/dismiss/`, {
                        method: 'POST',
                        headers: {
                            'X-CSRFToken': this.getCSRFToken(),
                            'Content-Type': 'application/json'
                        }
                    });

                    const data = await response.json();
                    if (data.success) {
                        this.loadNotifications();
                        this.showToast('Bildirim kapatÄ±ldÄ±', 'success');
                    }
                } catch (error) {
                    console.error('Bildirim kapatÄ±lÄ±rken hata:', error);
                    this.showToast('Bir hata oluÅŸtu', 'error');
                }
            }

            startPeriodicCheck() {
                // Ä°lk kontrolÃ¼ hemen yap (sayfa yÃ¼klendiÄŸinde)
                console.log('ðŸ”” Bildirim kontrol sistemi baÅŸlatÄ±ldÄ±');
                this.checkReminders();
                
                // Periyodik olarak bildirimleri yÃ¼kle ve hatÄ±rlatÄ±cÄ±larÄ± kontrol et
                setInterval(() => {
                    this.loadNotifications();
                    this.checkReminders();
                }, this.checkInterval);
                
                // Her 1 dakikada bir detaylÄ± log (debug iÃ§in)
                setInterval(() => {
                    const pendingReminders = this.notifications.filter(n => 
                        (n.type === 'event_reminder' || n.type === 'event_start') && 
                        (n.status === 'pending' || n.status === 'sent') && 
                        !n.shown
                    );
                    if (pendingReminders.length > 0) {
                        console.log(`ðŸ“‹ Bekleyen hatÄ±rlatÄ±cÄ±lar: ${pendingReminders.length}`, pendingReminders.map(n => ({
                            title: n.title,
                            time: n.scheduled_time,
                            type: n.type
                        })));
                    }
                }, 60000); // Her 1 dakikada bir
            }

            checkReminders() {
                // ZamanÄ± gelmiÅŸ bekleyen hatÄ±rlatÄ±cÄ±larÄ± kontrol et
                const now = new Date();
                let hasNewReminders = false;
                
                this.notifications.forEach(notification => {
                    // TÃ¼m bildirim tiplerini kontrol et (event_reminder, event_start, event_created)
                    const isEventNotification = notification.type === 'event_reminder' || 
                                                  notification.type === 'event_start' || 
                                                  notification.type === 'event_created';
                    
                    if ((notification.status === 'pending' || notification.status === 'sent') && 
                        isEventNotification) {
                        
                        const scheduledTime = new Date(notification.scheduled_time);
                        
                        // ZamanÄ± gelmiÅŸ mi kontrol et (daha geniÅŸ tolerans)
                        const timeDiff = now - scheduledTime;
                        const minutesDiff = timeDiff / (1000 * 60);
                        
                        // event_created iÃ§in hemen gÃ¶ster, diÄŸerleri iÃ§in zamanÄ± gelmiÅŸ olmalÄ±
                        const shouldShow = notification.type === 'event_created' 
                            ? (minutesDiff >= -5 && minutesDiff <= 60 && !notification.shown) // event_created iÃ§in 5 dakika Ã¶ncesinden 1 saat sonrasÄ±na kadar
                            : (minutesDiff >= -2 && minutesDiff <= 10 && !notification.shown); // HatÄ±rlatÄ±cÄ±lar iÃ§in 2 dakika Ã¶ncesinden 10 dakika sonrasÄ±na kadar
                        
                        if (shouldShow) {
                            console.log('ðŸ”” HatÄ±rlatÄ±cÄ± gÃ¶steriliyor:', notification.title, 'Zaman farkÄ±:', minutesDiff.toFixed(1), 'dakika');
                            
                            // SaÄŸ Ã¼stten alert gÃ¶ster - mesajÄ± da gÃ¶ster
                            const alertMessage = `${notification.title}\n${notification.message}`;
                            const alertType = notification.type === 'event_start' ? 'success' : 
                                             notification.type === 'event_created' ? 'info' : 'info';
                            
                            // Daha uzun sÃ¼re gÃ¶ster (hatÄ±rlatÄ±cÄ±lar iÃ§in)
                            this.showToast(alertMessage, alertType);
                            
                            // TarayÄ±cÄ± bildirimi gÃ¶ster (izin varsa)
                            if ('Notification' in window) {
                                if (Notification.permission === 'granted') {
                                    try {
                                        const browserNotification = new Notification(notification.title, {
                                            body: notification.message,
                                            icon: '/static/images/logo.svg',
                                            badge: '/static/images/logo.svg',
                                            tag: `notification-${notification.id}`,
                                            requireInteraction: notification.type === 'event_start', // Etkinlik baÅŸlangÄ±cÄ± iÃ§in daha uzun gÃ¶ster
                                            silent: false
                                        });
                                        
                                        // Bildirim kapandÄ±ÄŸÄ±nda veya tÄ±klandÄ±ÄŸÄ±nda
                                        browserNotification.onclick = function() {
                                            window.focus();
                                            this.close();
                                        };
                                    } catch (error) {
                                        console.error('TarayÄ±cÄ± bildirimi gÃ¶sterilirken hata:', error);
                                    }
                                } else if (Notification.permission === 'default') {
                                    // Ä°zin iste
                                    Notification.requestPermission().then(permission => {
                                        if (permission === 'granted') {
                                            console.log('âœ… TarayÄ±cÄ± bildirim izni verildi');
                                        }
                                    });
                                }
                            }
                            
                            // Bildirimi "gÃ¶sterildi" olarak iÅŸaretle (tekrar gÃ¶stermemek iÃ§in)
                            notification.shown = true;
                            hasNewReminders = true;
                            
                            // Backend'e bildirimi "sent" olarak iÅŸaretle
                            this.markNotificationAsSent(notification.id);
                        }
                    }
                });
                
                // Yeni hatÄ±rlatÄ±cÄ±lar varsa UI'Ä± gÃ¼ncelle
                if (hasNewReminders) {
                    this.updateUI();
                }
            }

            async markNotificationAsSent(notificationId) {
                try {
                    // Backend'e bildirim gÃ¶nderildi olarak iÅŸaretleme isteÄŸi gÃ¶nder
                    // Bu opsiyonel, eÄŸer backend'de otomatik olarak yapÄ±lÄ±yorsa gerek yok
                    await fetch(`/dashboard/api/notifications/${notificationId}/mark-sent/`, {
                        method: 'POST',
                        headers: {
                            'X-CSRFToken': this.getCSRFToken(),
                            'Content-Type': 'application/json'
                        }
                    });
                } catch (error) {
                    console.error('Bildirim gÃ¶nderildi olarak iÅŸaretlenirken hata:', error);
                }
            }

            getTimeAgo(dateString) {
                const now = new Date();
                const date = new Date(dateString);
                const diffMs = now - date;
                const diffMins = Math.floor(diffMs / 60000);
                const diffHours = Math.floor(diffMins / 60);
                const diffDays = Math.floor(diffHours / 24);

                if (diffMins < 1) return 'Åžimdi';
                if (diffMins < 60) return `${diffMins} dakika Ã¶nce`;
                if (diffHours < 24) return `${diffHours} saat Ã¶nce`;
                if (diffDays < 7) return `${diffDays} gÃ¼n Ã¶nce`;

                return date.toLocaleDateString('tr-TR');
            }

            getCSRFToken() {
                const token = document.querySelector('[name=csrfmiddlewaretoken]')?.value ||
                    document.querySelector('meta[name="csrf-token"]')?.getAttribute('content');

                if (!token) {
                    const cookies = document.cookie.split(';');
                    for (let cookie of cookies) {
                        const [name, value] = cookie.trim().split('=');
                        if (name === 'csrftoken') {
                            return value;
                        }
                    }
                }

                return token;
            }

            showToast(message, type = 'info') {
                // SweetAlert2 kullanarak toast gÃ¶ster
                if (typeof Swal !== 'undefined') {
                    // Ã‡ok satÄ±rlÄ± mesajlarÄ± title ve text olarak ayÄ±r
                    let title = message;
                    let text = '';
                    
                    if (message.includes('\n')) {
                        const parts = message.split('\n');
                        title = parts[0];
                        text = parts.slice(1).join('\n');
                    }
                    
                    // HatÄ±rlatÄ±cÄ±lar iÃ§in daha uzun sÃ¼re gÃ¶ster
                    const timer = type === 'success' ? 6000 : type === 'info' ? 8000 : 5000;
                    
                    Swal.fire({
                        title: title,
                        text: text || undefined,
                        icon: type === 'success' ? 'success' : type === 'error' ? 'error' : type === 'warning' ? 'warning' : 'info',
                        toast: true,
                        position: 'top-end',
                        showConfirmButton: false,
                        timer: timer,
                        timerProgressBar: true,
                        width: 'auto',
                        padding: '1rem',
                        didOpen: (toast) => {
                            // Mouse ile Ã¼zerine gelince durdur
                            toast.addEventListener('mouseenter', Swal.stopTimer);
                            toast.addEventListener('mouseleave', Swal.resumeTimer);
                            
                            // Ses Ã§al (opsiyonel - tarayÄ±cÄ± desteÄŸi varsa)
                            try {
                                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                                const oscillator = audioContext.createOscillator();
                                const gainNode = audioContext.createGain();
                                
                                oscillator.connect(gainNode);
                                gainNode.connect(audioContext.destination);
                                
                                oscillator.frequency.value = 800;
                                oscillator.type = 'sine';
                                
                                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                                
                                oscillator.start(audioContext.currentTime);
                                oscillator.stop(audioContext.currentTime + 0.1);
                            } catch (e) {
                                // Ses Ã§alma hatasÄ± gÃ¶rmezden gel
                            }
                        }
                    });
                } else {
                    // Fallback olarak alert kullan
                    alert(message);
                }
            }

            // Yeni bildirim geldiÄŸinde Ã§aÄŸrÄ±lacak
            addNotification(notification) {
                this.notifications.unshift(notification);
                this.unreadCount++;
                this.updateUI();

                // TarayÄ±cÄ± bildirimi gÃ¶ster (izin varsa)
                if (Notification.permission === 'granted') {
                    new Notification(notification.title, {
                        body: notification.message,
                        icon: '/static/images/logo.svg'
                    });
                }
            }

            // TarayÄ±cÄ± bildirim izni iste
            requestNotificationPermission() {
                if ('Notification' in window && Notification.permission === 'default') {
                    Notification.requestPermission();
                }
            }
        }

        // Sayfa yÃ¼klendiÄŸinde bildirim sistemini baÅŸlat
        document.addEventListener('DOMContentLoaded', function () {
            console.log('=== Bildirim Sistemi BaÅŸlatÄ±lÄ±yor ===');

            // Bootstrap'in yÃ¼klenmesini bekle
            function initializeDropdowns() {
                // Bootstrap kontrolÃ¼
                if (typeof bootstrap === 'undefined') {
                    console.warn('Bootstrap henÃ¼z yÃ¼klenmedi, bekleniyor...');
                    setTimeout(initializeDropdowns, 100);
                    return;
                }
                console.log('âœ“ Bootstrap yÃ¼klendi, versiyon:', bootstrap.Dropdown.VERSION);

                // Bildirim sistemini baÅŸlat
                window.notificationSystem = new NotificationSystem();
                window.notificationSystem.requestNotificationPermission();

                // Dropdown'Ä± manuel olarak baÅŸlat
                const notificationButton = document.getElementById('notificationButton');
                const notificationDropdown = document.getElementById('notificationDropdownMenu');

                if (notificationButton && notificationDropdown) {
                    console.log('âœ“ Bildirim butonu ve dropdown bulundu');

                    // Bootstrap Dropdown instance oluÅŸtur
                    try {
                        // Ã–nce mevcut instance'Ä± kontrol et
                        let dropdownInstance = bootstrap.Dropdown.getInstance(notificationButton);

                        if (!dropdownInstance) {
                            // Yeni instance oluÅŸtur
                            dropdownInstance = new bootstrap.Dropdown(notificationButton, {
                                autoClose: 'outside',
                                boundary: 'viewport'
                            });
                            console.log('âœ“ Dropdown instance oluÅŸturuldu');
                        } else {
                            console.log('âœ“ Dropdown instance zaten mevcut');
                        }

                        // Test iÃ§in butona tÄ±klandÄ±ÄŸÄ±nda log
                        notificationButton.addEventListener('click', function (e) {
                            console.log('Bildirim butonuna tÄ±klandÄ±');
                            console.log('Dropdown instance:', dropdownInstance);
                            console.log('Button aria-expanded:', notificationButton.getAttribute('aria-expanded'));
                        });

                        // Dropdown aÃ§Ä±ldÄ±ÄŸÄ±nda
                        notificationButton.addEventListener('shown.bs.dropdown', function () {
                            console.log('âœ“ Dropdown aÃ§Ä±ldÄ±!');
                            window.notificationSystem.loadNotifications();
                        });

                        // Dropdown kapandÄ±ÄŸÄ±nda
                        notificationButton.addEventListener('hidden.bs.dropdown', function () {
                            console.log('âœ“ Dropdown kapandÄ±');
                        });
                    } catch (error) {
                        console.error('Dropdown oluÅŸturma hatasÄ±:', error);
                    }
                } else {
                    console.error('HATA: Bildirim butonu veya dropdown bulunamadÄ±!');
                    console.log('notificationButton:', notificationButton);
                    console.log('notificationDropdown:', notificationDropdown);
                }

                // KullanÄ±cÄ± menÃ¼sÃ¼ dropdown'Ä±nÄ± baÅŸlat
                const userMenuButton = document.getElementById('userMenuButton');
                const userMenuDropdown = document.getElementById('userMenuDropdown');

                if (userMenuButton && userMenuDropdown) {
                    console.log('âœ“ KullanÄ±cÄ± menÃ¼sÃ¼ butonu ve dropdown bulundu');

                    try {
                        // Ã–nce mevcut instance'Ä± kontrol et
                        let userDropdownInstance = bootstrap.Dropdown.getInstance(userMenuButton);

                        if (!userDropdownInstance) {
                            // Yeni instance oluÅŸtur
                            userDropdownInstance = new bootstrap.Dropdown(userMenuButton, {
                                autoClose: true,
                                boundary: 'viewport'
                            });
                            console.log('âœ“ KullanÄ±cÄ± menÃ¼sÃ¼ dropdown instance oluÅŸturuldu');
                        } else {
                            console.log('âœ“ KullanÄ±cÄ± menÃ¼sÃ¼ dropdown instance zaten mevcut');
                        }

                        // Test iÃ§in butona tÄ±klandÄ±ÄŸÄ±nda log
                        userMenuButton.addEventListener('click', function (e) {
                            console.log('KullanÄ±cÄ± menÃ¼sÃ¼ butonuna tÄ±klandÄ±');
                            console.log('Dropdown instance:', userDropdownInstance);
                            console.log('Button aria-expanded:', userMenuButton.getAttribute('aria-expanded'));
                        });

                        // Dropdown aÃ§Ä±ldÄ±ÄŸÄ±nda
                        userMenuButton.addEventListener('shown.bs.dropdown', function () {
                            console.log('âœ“ KullanÄ±cÄ± menÃ¼sÃ¼ aÃ§Ä±ldÄ±!');
                        });

                        // Dropdown kapandÄ±ÄŸÄ±nda
                        userMenuButton.addEventListener('hidden.bs.dropdown', function () {
                            console.log('âœ“ KullanÄ±cÄ± menÃ¼sÃ¼ kapandÄ±');
                        });
                    } catch (error) {
                        console.error('KullanÄ±cÄ± menÃ¼sÃ¼ dropdown oluÅŸturma hatasÄ±:', error);
                    }
                } else {
                    console.log('KullanÄ±cÄ± menÃ¼sÃ¼ bulunamadÄ± (kullanÄ±cÄ± giriÅŸ yapmamÄ±ÅŸ olabilir)');
                }

                console.log('=== Bildirim Sistemi HazÄ±r ===');
            }

            // Ä°lk Ã§aÄŸrÄ±
            initializeDropdowns();
        });
    </script>
</body>

</html> <!- - Mobile Sidebar Toggle Function -->
    <script>
        function toggleMobileSidebar() {
            const sidebar = document.getElementById('admin-sidebar');

            if (sidebar) {
                // Sidebar'Ä± gÃ¶ster/gizle
                sidebar.classList.toggle('mobile-show');

                // Backdrop ekle/kaldÄ±r
                let backdrop = document.querySelector('.mobile-sidebar-backdrop');
                if (sidebar.classList.contains('mobile-show')) {
                    if (!backdrop) {
                        backdrop = document.createElement('div');
                        backdrop.className = 'mobile-sidebar-backdrop';
                        backdrop.onclick = toggleMobileSidebar;
                        document.body.appendChild(backdrop);
                    }
                } else {
                    if (backdrop) {
                        backdrop.remove();
                    }
                }
            }
        }

        // ESC tuÅŸu ile sidebar'Ä± kapat
        document.addEventListener('keydown', function (e) {
            if (e.key === 'Escape') {
                const sidebar = document.getElementById('admin-sidebar');
                if (sidebar && sidebar.classList.contains('mobile-show')) {
                    toggleMobileSidebar();
                }
            }
        });
    </script>

    <!-- Mobile Sidebar Backdrop Styles -->
    <style>
        .mobile-sidebar-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1040;
            display: block;
        }

        @media (min-width: 769px) {
            .mobile-sidebar-backdrop {
                display: none !important;
            }
        }

        /* Mobile Sidebar Show Animation */
        .admin-sidebar.mobile-show {
            transform: translateX(0) !important;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
        }
    </style>

    <!-- Dropdown Manuel BaÅŸlatma -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            console.log('=== Dropdown BaÅŸlatma Scripti ===');

            // Bootstrap'in yÃ¼klendiÄŸini kontrol et
            if (typeof bootstrap === 'undefined') {
                console.error('Bootstrap yÃ¼klenmedi!');
                return;
            }

            console.log('âœ“ Bootstrap yÃ¼klendi, versiyon:', bootstrap.Dropdown.VERSION);

            // Bildirim dropdown'Ä±nÄ± baÅŸlat
            const notificationButton = document.getElementById('notificationButton');
            const notificationDropdown = document.getElementById('notificationDropdownMenu');

            if (notificationButton && notificationDropdown) {
                console.log('âœ“ Bildirim butonu ve dropdown bulundu');

                // Dropdown instance oluÅŸtur
                const notificationDropdownInstance = new bootstrap.Dropdown(notificationButton, {
                    autoClose: 'outside',
                    boundary: 'viewport'
                });

                console.log('âœ“ Bildirim dropdown instance oluÅŸturuldu');

                // Manuel toggle iÃ§in event listener ekle
                notificationButton.addEventListener('click', function (e) {
                    e.preventDefault();
                    e.stopPropagation();

                    console.log('Bildirim butonuna tÄ±klandÄ±');
                    console.log('Dropdown instance:', notificationDropdownInstance);
                    console.log('Button aria-expanded:', notificationButton.getAttribute('aria-expanded'));

                    // Dropdown'Ä± toggle et
                    notificationDropdownInstance.toggle();

                    // AÃ§Ä±ldÄ±ÄŸÄ±nda/kapandÄ±ÄŸÄ±nda log
                    if (notificationButton.getAttribute('aria-expanded') === 'true') {
                        console.log('âœ“ Dropdown aÃ§Ä±ldÄ±!');
                    } else {
                        console.log('âœ“ Dropdown kapandÄ±');
                    }
                });
            } else {
                console.error('Bildirim butonu veya dropdown bulunamadÄ±!');
            }

            // KullanÄ±cÄ± menÃ¼sÃ¼ dropdown'Ä±nÄ± baÅŸlat
            const userMenuButton = document.getElementById('userMenuButton');
            const userMenuDropdown = document.getElementById('userMenuDropdown');

            if (userMenuButton && userMenuDropdown) {
                console.log('âœ“ KullanÄ±cÄ± menÃ¼sÃ¼ butonu ve dropdown bulundu');

                // Dropdown instance oluÅŸtur
                const userMenuDropdownInstance = new bootstrap.Dropdown(userMenuButton, {
                    autoClose: true,
                    boundary: 'viewport'
                });

                console.log('âœ“ KullanÄ±cÄ± menÃ¼sÃ¼ dropdown instance oluÅŸturuldu');

                // Manuel toggle iÃ§in event listener ekle
                userMenuButton.addEventListener('click', function (e) {
                    e.preventDefault();
                    e.stopPropagation();

                    console.log('KullanÄ±cÄ± menÃ¼sÃ¼ butonuna tÄ±klandÄ±');
                    console.log('Dropdown instance:', userMenuDropdownInstance);
                    console.log('Button aria-expanded:', userMenuButton.getAttribute('aria-expanded'));

                    // Dropdown'Ä± toggle et
                    userMenuDropdownInstance.toggle();

                    // AÃ§Ä±ldÄ±ÄŸÄ±nda/kapandÄ±ÄŸÄ±nda log
                    if (userMenuButton.getAttribute('aria-expanded') === 'true') {
                        console.log('âœ“ KullanÄ±cÄ± menÃ¼sÃ¼ aÃ§Ä±ldÄ±!');
                    } else {
                        console.log('âœ“ KullanÄ±cÄ± menÃ¼sÃ¼ kapandÄ±');
                    }
                });
            } else {
                console.error('KullanÄ±cÄ± menÃ¼sÃ¼ butonu veya dropdown bulunamadÄ±!');
            }

            console.log('=== Dropdown Sistemi HazÄ±r ===');
        });
    </script>
    </body>

    </html>